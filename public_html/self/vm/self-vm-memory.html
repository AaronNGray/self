<TITLE>The Self Virtual Machine</TITLE>

<H1>The Memory System</H1>

<H3>The memory system</H3>
Different kinds of objects <P>

<H3>universe and spaces</H3>
Invariant: free word in each space for sentinel. Byte parts are word-aligned (why?). <P>

<H3>The heap</H3>
The heap is where all Self objects reside. It is currently organised into two generations, new and old, for the purposes of allocation and garbage collection (see classes universe, generation, newGeneration and oldGeneration). <P>

The new generation is divided into three fixed-size spaces, known as Eden and two survivor spaces. At any given time, one of the survivor spaces is known as From space, and the other as To space. <P>

The old generation consists of a linked list of old spaces. At system startup there is a single space on this list; new spaces may be added to the list by the ExpandHeap primitive. The order of spaces in the list can change during execution. <P>

New objects are allocated in Eden if possible (with some exceptions [such as strings, which are allocated in old space; others?]). If not possible, the allocation routines will try From space, then To space, then each of the spaces in the old generation in turn. When Eden fills, a scavenge is initiated. The scavenge finds survivors in Eden and From space, and moves them into either To space or the old generation, depending on their ages (and whether To space fills). Then Eden and the From space are marked as empty, and the From and To spaces are interchanged. This is a classical generation scavenger. <P>

Something about the remembered set and card marking.  <P>

All spaces in the old generation must come at higher addresses than spaces in the new generation. Each generation records the maximum and minimum addresses it uses, for the benefit of the card marker. <P>

Spaces are multiples of the page size, and page aligned, so that mmap() can be used to read and write spaces. <P>
Snapshots. Compressed snapshots. Startup parameters. <P>
Explain the trick of using cards when switching pointers <P>

<H3></H3>

<H3></H3>
